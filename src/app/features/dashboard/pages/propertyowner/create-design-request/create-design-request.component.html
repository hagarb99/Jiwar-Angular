<div class="min-h-screen bg-gray-50/50 py-8">
  <p-toast></p-toast>

  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header -->
    <div class="mb-8">
      <h1 class="text-3xl font-bold text-gray-900 mb-2">Create Design Request</h1>
      <p class="text-gray-600">Fill in the details to request interior design services for your property</p>
    </div>

    <!-- Progress Steps -->
    <div class="mb-8">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2" [class.text-blue-600]="currentStep >= 1">
          <div class="w-8 h-8 rounded-full flex items-center justify-center font-semibold"
            [class.bg-blue-600]="currentStep >= 1" [class.bg-gray-200]="currentStep < 1"
            [class.text-white]="currentStep >= 1" [class.text-gray-500]="currentStep < 1">
            <span *ngIf="currentStep > 1">✓</span>
            <span *ngIf="currentStep <= 1">1</span>
          </div>
          <span class="hidden sm:block">Select Property</span>
        </div>
        <div class="flex-1 h-1 mx-4" [class.bg-blue-600]="currentStep >= 2" [class.bg-gray-200]="currentStep < 2"></div>
        <div class="flex items-center gap-2" [class.text-blue-600]="currentStep >= 2">
          <div class="w-8 h-8 rounded-full flex items-center justify-center font-semibold"
            [class.bg-blue-600]="currentStep >= 2" [class.bg-gray-200]="currentStep < 2"
            [class.text-white]="currentStep >= 2" [class.text-gray-500]="currentStep < 2">
            <span *ngIf="currentStep > 2">✓</span>
            <span *ngIf="currentStep <= 2">2</span>
          </div>
          <span class="hidden sm:block">Request Details</span>
        </div>
        <div class="flex-1 h-1 mx-4" [class.bg-blue-600]="currentStep >= 3" [class.bg-gray-200]="currentStep < 3"></div>
        <div class="flex items-center gap-2" [class.text-blue-600]="currentStep >= 3">
          <div class="w-8 h-8 rounded-full flex items-center justify-center font-semibold"
            [class.bg-blue-600]="currentStep >= 3" [class.bg-gray-200]="currentStep < 3"
            [class.text-white]="currentStep >= 3" [class.text-gray-500]="currentStep < 3">
            3
          </div>
          <span class="hidden sm:block">Review Request</span>
        </div>
      </div>
    </div>

    <!-- Step 1: Select Property -->
    <div *ngIf="currentStep === 1" class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
      <h2 class="text-xl font-bold text-gray-900 mb-6">Select Property</h2>

      <div *ngIf="loading" class="text-center py-12">
        <p-progressSpinner></p-progressSpinner>
        <p class="mt-4 text-gray-500">Loading properties...</p>
      </div>

      <div *ngIf="!loading && properties.length === 0" class="text-center py-12">
        <p class="text-gray-500 mb-4">You don't have any properties yet.</p>
        <p-button label="Add Property" routerLink="/dashboard/propertyowner/my-properties" [outlined]="true"></p-button>
      </div>

      <div *ngIf="!loading && properties.length > 0" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div *ngFor="let property of properties" class="p-4 border-2 rounded-lg cursor-pointer transition-all"
          [class.border-blue-600]="selectedProperty?.propertyID === property.propertyID"
          [class.border-gray-200]="selectedProperty?.propertyID !== property.propertyID"
          [class.bg-blue-50]="selectedProperty?.propertyID === property.propertyID"
          (click)="selectedProperty = property">
          <h3 class="font-semibold text-gray-900 mb-2">{{ property.title }}</h3>
          <p class="text-sm text-gray-600 mb-1">{{ property.address }}</p>
          <p class="text-sm text-gray-500">{{ property.city }}, {{ property.district }}</p>
          <p class="text-lg font-bold text-blue-600 mt-2">{{ property.price | number }} EGP</p>
        </div>
      </div>
    </div>

    <!-- Step 2: Request Details -->
    <form [formGroup]="requestForm" *ngIf="currentStep === 2"
      class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
      <h2 class="text-xl font-bold text-gray-900 mb-6">Request Details</h2>

      <div class="space-y-6">
        <!-- Preferred Style -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Preferred Style *</label>
          <p-dropdown formControlName="preferredStyle" [options]="styleOptions" placeholder="Select a style"
            class="w-full"
            [class.ng-invalid]="requestForm.get('preferredStyle')?.invalid && requestForm.get('preferredStyle')?.touched">
          </p-dropdown>
          <small *ngIf="requestForm.get('preferredStyle')?.invalid && requestForm.get('preferredStyle')?.touched"
            class="text-red-500">Style is required</small>
        </div>

        <!-- Budget -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Budget (SAR)</label>
          <p-inputNumber formControlName="budget" mode="currency" currency="EGP" [min]="0" placeholder="Enter budget"
            class="w-full">
          </p-inputNumber>
        </div>

        <!-- Notes -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Notes</label>
          <textarea pInputTextarea formControlName="notes" rows="5"
            placeholder="Describe your design requirements, preferences, or any specific needs..." class="w-full">
          </textarea>
        </div>

        <!-- Reference Images -->
        <div>
          <label class="block text-sm font-semibold text-gray-700 mb-2">Reference Images (URLs)</label>
          <div class="flex gap-2 mb-2">
            <input pInputText type="url" [(ngModel)]="newImageUrl" [ngModelOptions]="{standalone: true}"
              placeholder="Enter image URL" (keyup.enter)="addImageUrl()" class="flex-1">
            <p-button label="Add" icon="pi pi-plus" (onClick)="addImageUrl()" [outlined]="true"></p-button>
          </div>
          <div *ngIf="referenceImageUrls.length > 0" class="flex flex-wrap gap-2 mt-2">
            <span *ngFor="let url of referenceImageUrls; let i = index"
              class="px-3 py-1 bg-gray-100 rounded-lg text-sm flex items-center gap-2">
              <span class="truncate max-w-xs">{{ url }}</span>
              <button (click)="removeImageUrl(i)" class="text-red-500 hover:text-red-700">×</button>
            </span>
          </div>
        </div>

        <!-- Is For Sale Enhancement -->
        <div class="flex items-center gap-2">
          <p-checkbox formControlName="isForSaleEnhancement" [binary]="true" inputId="forSale"></p-checkbox>
          <label for="forSale" class="text-sm text-gray-700">This design is for sale enhancement</label>
        </div>
      </div>
    </form>

    <!-- Step 3: Review & Submit -->
    <div *ngIf="currentStep === 3" class="bg-white rounded-2xl p-6 shadow-sm border border-gray-100">
      <h2 class="text-xl font-bold text-gray-900 mb-6">Review & Submit</h2>

      <div class="space-y-6">

        <!-- Summary: Property -->
        <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
          <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Property Details</h3>
          <div class="flex items-start gap-4">
            <div class="w-12 h-12 rounded-lg bg-blue-100 flex items-center justify-center text-blue-600">
              <i class="pi pi-home text-xl"></i>
            </div>
            <div>
              <h4 class="font-bold text-gray-900 text-lg">{{ selectedProperty?.title }}</h4>
              <p class="text-gray-600">{{ selectedProperty?.address }}</p>
              <p class="text-gray-500 text-sm">{{ selectedProperty?.city }}, {{ selectedProperty?.district }}</p>
            </div>
          </div>
        </div>

        <!-- Summary: Design Request -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
            <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2">Preferred Style</h3>
            <p class="font-semibold text-gray-900">{{ requestForm.get('preferredStyle')?.value }}</p>
          </div>

          <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
            <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2">Budget</h3>
            <p class="font-semibold text-gray-900" *ngIf="requestForm.get('budget')?.value">
              {{ requestForm.get('budget')?.value | currency:'EGP':'symbol':'1.0-0' }}
            </p>
            <p class="text-gray-500 italic" *ngIf="!requestForm.get('budget')?.value">Not specified</p>
          </div>
        </div>

        <!-- Summary: Notes -->
        <div class="bg-gray-50 rounded-xl p-4 border border-gray-200">
          <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-2">Description / Notes</h3>
          <p class="text-gray-700 whitespace-pre-line" *ngIf="requestForm.get('notes')?.value">{{
            requestForm.get('notes')?.value }}</p>
          <p class="text-gray-500 italic" *ngIf="!requestForm.get('notes')?.value">No additional notes provided.</p>
        </div>

        <!-- Summary: Images -->
        <div *ngIf="referenceImageUrls.length > 0" class="bg-gray-50 rounded-xl p-4 border border-gray-200">
          <h3 class="text-sm font-bold text-gray-500 uppercase tracking-wider mb-3">Reference Images</h3>
          <div class="flex flex-wrap gap-2">
            <div *ngFor="let url of referenceImageUrls"
              class="w-24 h-24 rounded-lg overflow-hidden border border-gray-200 bg-white">
              <img [src]="url" alt="Reference" class="w-full h-full object-cover">
            </div>
          </div>
        </div>

        <!-- Enhance for Sale Badge -->
        <div *ngIf="requestForm.get('isForSaleEnhancement')?.value"
          class="flex items-center gap-2 text-green-600 bg-green-50 p-3 rounded-lg border border-green-100">
          <i class="pi pi-check-circle"></i>
          <span class="font-medium">This design is intended for property sale enhancement.</span>
        </div>

      </div>
    </div>

    <!-- Navigation Buttons -->
    <div class="mt-8 flex justify-between">
      <p-button *ngIf="currentStep > 1" label="Previous" icon="pi pi-arrow-left" (onClick)="previousStep()"
        [outlined]="true">
      </p-button>
      <div *ngIf="currentStep < 3" class="ml-auto">
        <p-button label="Next" icon="pi pi-arrow-right" iconPos="right" (onClick)="nextStep()"
          [disabled]="loading || saving">
        </p-button>
      </div>
      <div *ngIf="currentStep === 3" class="ml-auto">
        <p-button label="Submit Request" icon="pi pi-check" (onClick)="submitRequest()" [loading]="saving"
          [disabled]="saving">
        </p-button>
      </div>
    </div>
  </div>
</div>