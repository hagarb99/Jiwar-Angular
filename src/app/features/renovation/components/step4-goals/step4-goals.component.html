<div class="min-h-screen bg-slate-50 flex flex-col font-sans">
    <app-navbar></app-navbar>

    <div class="flex-grow flex flex-col items-center p-6 sm:p-10">

        <!-- Stepper -->
        <div class="w-full max-w-4xl flex items-center justify-center mb-12">
            <div class="flex items-center gap-4">
                <!-- Details -->
                <div class="flex items-center gap-2 bg-[#EBE4D3] text-[#BA9F60] px-5 py-2.5 rounded-full cursor-pointer hover:bg-[#E0D8C0] transition-colors"
                    routerLink="/renovation/details">
                    <i class="pi pi-check text-xs"></i>
                    <span class="font-bold text-sm">Details</span>
                </div>

                <!-- Connector -->
                <div class="w-12 h-[2px] bg-[#DCCCA3]"></div>

                <!-- Media -->
                <div class="flex items-center gap-2 bg-[#EBE4D3] text-[#BA9F60] px-5 py-2.5 rounded-full cursor-pointer hover:bg-[#E0D8C0] transition-colors"
                    routerLink="/renovation/media">
                    <i class="pi pi-check text-xs"></i>
                    <span class="font-bold text-sm">Media</span>
                </div>

                <!-- Connector -->
                <div class="w-12 h-[2px] bg-[#DCCCA3]"></div>

                <!-- Goals (Active) -->
                <div
                    class="flex items-center gap-2 bg-[#DCCCA3] text-[#1E293B] px-5 py-2.5 rounded-full shadow-md z-10 transform scale-105">
                    <i class="pi pi-bullseye"></i>
                    <span class="font-bold text-sm">Goals</span>
                </div>

                <!-- Connector -->
                <div class="w-12 h-[2px] bg-[#DCCCA3]"></div>

                <!-- Results -->
                <div
                    class="flex items-center gap-2 bg-[#F0EAD6] text-[#A69060] px-5 py-2.5 rounded-full z-10 opacity-70">
                    <i class="pi pi-lightbulb"></i>
                    <span class="font-bold text-sm">Results</span>
                </div>
            </div>
        </div>

        <!-- Header -->
        <div class="w-full max-w-2xl text-center mb-10">
            <h2 class="text-3xl font-bold text-slate-900 mb-2">Renovation Goals</h2>
            <p class="text-slate-500 text-lg">Define your priorities and budget.</p>
        </div>

        <!-- Main Form Card -->
        <form [formGroup]="goalsForm" (ngSubmit)="onSubmit()"
            class="bg-white p-8 sm:p-10 rounded-3xl shadow-sm border border-slate-100 w-full max-w-4xl space-y-8">

            <!-- Renovation Goals Section -->
            <div>
                <label class="block text-xl font-bold text-slate-900 mb-4">What are your main goals?</label>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div *ngFor="let goal of availableGoals" (click)="toggleGoal(goal.value)"
                        class="cursor-pointer flex items-center gap-4 p-4 rounded-xl border transition-all text-left group select-none"
                        [class.border-slate-100]="!isSelected(goal.value)" [class.bg-white]="!isSelected(goal.value)"
                        [class.shadow-sm]="!isSelected(goal.value)" [class.border-[#DCCCA3]]="isSelected(goal.value)"
                        [class.bg-[#FDFBF7]]="isSelected(goal.value)" [class.ring-1]="isSelected(goal.value)"
                        [class.ring-[#DCCCA3]]="isSelected(goal.value)">

                        <div class="w-12 h-12 rounded-full flex items-center justify-center transition-colors shrink-0"
                            [ngClass]="isSelected(goal.value) ? 'bg-[#EBE4D3] text-[#BA9F60]' : 'bg-slate-50 text-slate-400 group-hover:bg-[#F9F6F0] group-hover:text-[#BA9F60]'">
                            <i [class]="goal.icon" class="text-lg"></i>
                        </div>
                        <div class="flex-grow">
                            <span class="font-bold block"
                                [ngClass]="isSelected(goal.value) ? 'text-slate-900' : 'text-slate-600 group-hover:text-slate-900'">
                                {{ goal.label }}
                            </span>
                        </div>
                        <i *ngIf="isSelected(goal.value)" class="pi pi-check-circle text-[#BA9F60] text-xl"></i>
                    </div>
                </div>
                <!-- Validation Msg -->
                <div *ngIf="goalsForm.get('goals')?.touched && goalsForm.get('goals')?.invalid"
                    class="text-red-500 text-sm mt-3 flex items-center gap-2">
                    <i class="pi pi-exclamation-circle"></i>
                    At least one goal is required
                </div>
            </div>

            <hr class="border-slate-100">

            <!-- Budget & Timeline -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                <div>
                    <label class="block text-sm font-bold text-slate-900 mb-2 ml-1">Estimated Budget</label>
                    <div class="relative">
                        <select (change)="onBudgetChange($event)"
                            class="w-full bg-[#F9F6F0] border border-transparent rounded-xl px-4 py-3.5 text-slate-700 appearance-none focus:ring-2 focus:ring-[#DCCCA3] focus:bg-white outline-none cursor-pointer transition-all">
                            <option [value]="null">Select budget range</option>
                            <option value="10000-30000">$10,000 - $30,000</option>
                            <option value="30000-60000">$30,000 - $60,000</option>
                            <option value="60000-999999">$60,000+</option>
                        </select>
                        <i
                            class="pi pi-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-[#BA9F60] pointer-events-none"></i>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-bold text-slate-900 mb-2 ml-1">Timeline Preference</label>
                    <div class="relative">
                        <select
                            class="w-full bg-[#F9F6F0] border border-transparent rounded-xl px-4 py-3.5 text-slate-700 appearance-none focus:ring-2 focus:ring-[#DCCCA3] focus:bg-white outline-none cursor-pointer transition-all">
                            <option selected>Flexible</option>
                            <option>Immediately</option>
                            <option>Within 3 months</option>
                            <option>Within 6 months</option>
                        </select>
                        <i
                            class="pi pi-chevron-down absolute right-4 top-1/2 transform -translate-y-1/2 text-[#BA9F60] pointer-events-none"></i>
                    </div>
                </div>
            </div>

            <!-- Notes -->
            <div>
                <label class="block text-sm font-bold text-slate-900 mb-2 ml-1">Additional Notes (Optional)</label>
                <textarea formControlName="notes" rows="4"
                    placeholder="Any specific requirements, styling preferences, or concerns..."
                    class="w-full bg-[#F9F6F0] border border-transparent rounded-xl px-4 py-3.5 text-slate-700 placeholder-slate-400 focus:ring-2 focus:ring-[#DCCCA3] focus:bg-white outline-none resize-none transition-all"></textarea>
            </div>

            <!-- Navigation Buttons -->
            <div class="flex justify-between items-center mt-8 pt-4 border-t border-slate-100">
                <button type="button" routerLink="/renovation/media"
                    class="text-slate-500 font-bold hover:text-slate-800 transition-colors flex items-center gap-2 px-4 py-2">
                    <i class="pi pi-arrow-left text-xs"></i>
                    Back
                </button>
                <button type="submit" [disabled]="goalsForm.invalid || isSubmitting"
                    class="bg-[#DCCCA3] hover:bg-[#D2C090] disabled:opacity-70 disabled:cursor-not-allowed text-slate-900 font-bold py-3.5 px-8 rounded-xl transition-all duration-300 flex items-center gap-2 shadow-sm transform hover:scale-[1.02]">
                    <span *ngIf="!isSubmitting">Generate Recommendations</span>
                    <span *ngIf="isSubmitting">Analying...</span>
                    <!-- Icon animation/change based on state -->
                    <i *ngIf="!isSubmitting" class="pi pi-sparkles text-xs"></i>
                    <i *ngIf="isSubmitting" class="pi pi-spin pi-spinner text-xs"></i>
                </button>
            </div>
        </form>
    </div>

    <app-footer></app-footer>
</div>